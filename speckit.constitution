# SoloKey Project Constitution

## 1. 專案定位與願景

-   專案名稱：**SoloKey**
-   類型：Web 版卡拉 OK / 音高分析與節奏練習平台
-   願景：
    -   讓一般使用者可以在瀏覽器中上傳或選擇歌曲，跟著伴奏唱歌，並即時看到音高、節奏與準確度。
    -   提供「遊戲化」的練唱體驗（分數、COMBO、等級、成就），降低練歌門檻。

## 2. 目標與非目標

### 2.1 目標（Goals）

-   建立一個 **高品質、可被充分測試（testable）的 Minimum Viable Product（MVP）**：
    -   功能範圍以 MVP 為主，避免過度設計（no overdesign），先確保體驗完整與穩定，再逐步擴充。
-   提供基礎但順暢的 **獨唱練習流程**：
    -   選歌 → 準備 → 播放伴奏 & 收音 → 即時顯示音高與節奏 → 結算成績。
-   支援 **MP3 / WAV 上傳**，讓使用者可以用自己的音檔練唱。
-   提供 **基礎音高偵測與音準評分**（以音階 / 半音差距為主）。
-   支援 **桌機 Chrome / Edge**，延遲控制在可接受範圍內（目標 < 150ms 感知延遲）。
-   提供 **簡潔清楚的 UI**，在螢幕 1080p 下使用體驗優先。

### 2.2 非目標（Non-goals）

-   非即時直播平台：不處理多人同時合唱、線上對戰。
-   非完整 Spotify / KKBOX：不處理串流授權，只支援使用者自備音檔與少量示範歌庫。
-   非 DAW：不提供複雜的音軌編輯混音能力。
-   不追求一開始就支援所有行動裝置，優先桌機瀏覽器。
-   不為尚未驗證的需求做過度抽象或複雜架構設計，避免 overdesign。

## 3. 目標使用者（Target Users）

-   喜歡唱歌，但不熟音樂理論的 **一般使用者**。
-   想要有明確分數與視覺回饋的 **自我練習者**。
-   可能用於示範或教學的 **聲樂老師 / 社團指導**（MVP 僅提供個人練習）。

## 4. 技術堆疊與架構原則

-   前端框架：**Next.js 16 + React 19 (App Router)**。
-   樣式系統：**Tailwind CSS 4** 為主，搭配自訂 UI 元件（未來可考慮 shadcn/ui）。
-   語言：**TypeScript 5**。
-   後端：
    -   `apps/server` 使用 Node.js（可採 Express / Fastify，依後續決策）。
    -   只做必要 API：歌曲清單、譜面 / 設定讀寫、簡單帳號系統（若有）。
-   共用程式碼：`packages/shared` 放型別定義、音樂相關計算邏輯（例如 Pitch 評分公式）。
-   儲存：
    -   MVP 以檔案系統 / 簡單 DB 儲存歌曲 / 曲目設定與使用者紀錄。
    -   不處理大規模多租戶 SaaS 的需求。

## 5. 程式碼品質原則

-   一律使用 **嚴格 TypeScript**，禁止使用 `any`：
    -   若實在需要，必須以嚴格的泛型或型別守衛包起來，並在註解說明原因。
-   前端與後端皆需符合 `typescript-eslint` 規則，不使用註解關閉 ESLint，除非有明確理由。
-   嚴格區分：
    -   Domain 型別（如 `Song`, `ScoreResult`, `PitchFrame`）
    -   API DTO（如 `SongDto`, `ScoreResultDto`）
    -   UI State 型別（如 `SoloSessionState`）。
-   每個重要模組需有對應測試：
    -   音高與節奏演算法：單元測試（edge cases）。
    -   譜面解析：單元測試。
    -   核心 React hooks：單元測試。
-   新功能應附上最基本的測試覆蓋率，而不是事後補；MVP 也必須是 **可測試、可維護** 的品質，而非一次性 demo。

## 6. 使用者體驗與設計原則

-   介面風格：
    -   乾淨、現代、偏暗色、符合長時間盯著螢幕練歌的需求。
    -   使用 Tailwind design tokens 統一顏色、字體與間距。
-   互動原則：
    -   任何錄音、麥克風權限，需要清楚的提示與解說。
    -   音高 / 分數顯示要「樂觀且鼓勵」，避免過度挫折，例如用顏色與小動畫表示表現區間。
-   無障礙與國際化：
    -   文案預設為正體中文，保留未來多語支援空間（字串集中管理）。
    -   重要資訊（分數、段落、提示）避免只靠顏色，輔以文字 / icon。

## 7. 安全性與隱私

-   只在使用者同意的情況下存放錄音結果：
    -   MVP 可以只存 **分析後的特徵 / 分數** 而不存原始錄音檔。
-   不收集不必要的個資。
-   對重要設定（例如：帳號登入、購買記錄）採用安全的通訊協定（HTTPS、JWT 或其他安全方案）。

## 8. 開發流程與 AI Agent 使用

-   使用 Git + feature 分支開發。
-   使用 **Spec Kit** + AI agent（Codex CLI / Copilot）遵守下列流程：
    1. `/speckit.specify` 先建立功能規格，不跳過這一步。
    2. `/speckit.plan` 再決定技術方案與架構。
    3. `/speckit.tasks` 拆解為小任務。
    4. 針對單一任務，請 AI 實作；每次 PR 只解一組小任務。
-   若 AI 實作與此 Constitution 矛盾，以 Constitution 為準，人類負責審查與修正。
-   優先產出「**能正常運作、可被測試的 MVP**」，再考慮重構與設計優化，避免一開始就投入過多時間在過度抽象或通用化。

## 9. 文件與註解

-   所有對外 README、主要架構解說文件、關鍵註解、UI 文案與預設 commit message **一律使用正體中文**（程式庫名稱、技術名詞需保留原文時除外）。
-   關鍵演算法（音高偵測、節奏對齊、評分公式）必須有清楚的註解與附加說明文件。
-   若需英文文件，採「正體中文為主、英文為輔」的方式撰寫。

## 10. 既有程式碼使用原則（Legacy Code Policy）

- 目前這個 SoloKey 專案中的程式碼，全部視為「試作版 v0」。
- 之後透過 Spec Kit（/speckit.* 指令）產生的規格、計畫與任務，都是為了建立「SoloKey v1」。
- AI 在實作時可以閱讀並參考現有程式碼，但 **不需要維持相容性**。
- 只要 `.specify/constitution.md` 或最新的 `specs/*`, `plans/*`, `tasks/*` 與現有程式碼有衝突：
  - **以 constitution + spec + plan + tasks 為唯一真實來源**。
  - 允許刪除、重命名或重寫任何檔案（包含 `apps/web`, `apps/server`, `packages/shared` 等），以符合新的設計。
- 舊程式碼如果有可重用的部分，應在 plan 或 tasks 中註明「沿用 XXX」，其餘一律視為可替換的 legacy code。
