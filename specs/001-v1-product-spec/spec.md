# 功能規格：SoloKey v1 – 單人練唱、分享與對唱

**功能分支**：`001-solokey-v1`  
**建立日期**：2025-11-27  
**狀態**：Draft  
**說明**：本規格定義 SoloKey v1 的整體產品行為，包含「單人練唱」、「分享共賞」、「雙人對唱」與「歷史回顧」四大情境。老師／學生的角色已完全移除，改為一般使用者彼此分享與協作。

---

## 1. 產品定位與角色

### 1.1 定位

SoloKey 是一個在瀏覽器中使用的 **個人練唱與音準分析教練**：

-   讓使用者上傳歌曲音檔，跟著唱歌並即時看到自己的音高與節奏表現。
-   唱完會得到分數與簡單建議，並可**回顧歷史**、**分享給他人看**，或與朋友進行**雙人對唱**。

### 1.2 主要角色

1. **單人練唱者（Primary）**

    - 想要練好一首歌、知道自己準不準。
    - 核心需求：快速上傳、簡單設定、即時視覺化、唱完有分數與建議。

2. **分享觀眾／合作夥伴（Secondary）**

    - 收到主唱分享連結的人，可以看結果或即時曲線、留言或給反應。
    - 不具「強制指派」權限，純粹是觀摩與互動。

3. **對唱夥伴（Secondary）**
    - 兩人一起練唱相同段落或不同聲部，互相比較與協作。
    - 需要較穩定的同步與延遲控制。

> 不再存在「老師／學生」這種階層關係；所有人都只是「使用者」，可以在需要時扮演主唱或觀眾／對唱者。

## 1.3 v1 / MVP 範圍

-   v1（MVP）必須完成：
    -   P1：單人練唱完整流程（上傳 → 練唱 → 結算）。
    -   P4：最基本的歷史記錄列表與詳細檢視（至少記錄最近 20 筆）。
-   v1 若時程允許，優先加入：
    -   P2：結果分享（先支援「非即時」分享，再視情況加入「即時共賞」）。
-   P3：雙人對唱為延伸功能，可以在 v1.1 或 v2 規劃；本規格先定義行為，以利後續設計與估工。

---

## 2. 使用者情境與優先度

### P1 – 單人練唱並完成一次完整練習（Priority: P1）

**描述**  
使用者第一次使用 SoloKey，可以在不看教學的情況下完成以下流程：

1. 在首頁理解 SoloKey 是什麼、能幫他做什麼。
2. 上傳一個合法的歌曲音檔，填寫曲名與歌手（可選）。
3. 完成麥克風測試與基本設定（音量、延遲校正簡易流程）。
4. 播放伴奏並跟著唱時，畫面顯示標準曲線與即時曲線，使用者看得出自己偏高／偏低／節奏慢或快。
5. 歌曲結束後看到總分、段落分數與 1–3 則重點建議，可選擇重練或儲存這次紀錄。

**驗收情境（舉例）**

1. Given 使用者為第一次造訪，When 依介面指示完成「上傳 → 設定 → 練唱 → 結算」，Then 全程不需要額外說明即可完成並看到分數。
2. Given 使用者在練唱中暫停，When 重新播放，Then 即時曲線與時間軸重新對齊，結果只以最新一次錄製為準。

---

### P2 – 分享與共賞（Priority: P2）

**描述**  
完成一次單人練唱之後，主唱可以選擇把這次結果分享給親友：

1. 在結果頁按下「分享」或「邀請共賞」，系統產生一組分享連結或代碼。
2. 任何取得連結的人都可以在瀏覽器中開啟，看到：
    - 這次練唱的標準曲線、實際曲線、總分與段落分數。
    - 主唱的暱稱（依使用者隱私設定決定是否顯示）。
    - 基礎的互動功能（例如：留言、表情反應）。
3. 若主唱選擇「即時分享」，觀眾在主唱練唱時可以看到接近即時的曲線更新（延遲控制在可接受範圍內）。
4. 主唱隨時可以結束分享或收回連結，觀眾將無法再繼續查看即時資料。

**驗收情境（舉例）**

1. Given 主唱已完成練唱，When 在結果頁建立分享連結並分享給 3 位好友，Then 3 位好友在各自裝置中打開連結後，能看到完整結果與基本互動。
2. Given 分享處於開啟狀態，When 主唱點擊「結束分享」，Then 所有觀眾在 1–2 秒內收到已結束的提示，並無法再刷新即時內容。

---

### P3 – 雙人對唱練習（Priority: P3）

**描述**  
兩位使用者想要一起練唱同一首歌，可以透過「對唱房」功能：

1. 主唱建立一個對唱房，指定歌曲與段落（整首歌或片段），系統產生房間代碼。
2. 對唱夥伴輸入房間代碼加入對唱房，看到簡單的等待畫面與同步提示。
3. 當雙方都準備好後，系統開始播放伴奏並同時錄製兩路聲音：
    - UI 顯示兩條即時曲線（例如不同顏色），並提示雙方相對差距與節奏一致度。
4. 對唱結束後產生：
    - 個別分數與建議（各自的音準與節奏）。
    - 合唱一致性指標（例如：和聲穩定度、進入點差距）。
5. 對唱結果可以選擇儲存到歷史記錄或僅暫時查看。

**邊界條件**

-   對唱房同時只允許 **2 名主唱**；最多可允許最多 2 名觀眾以「只讀模式」加入觀看。
-   任一方網路中斷時，系統需在 10 秒內允許其重連並盡量維持原有進度，另一方收到提示可以暫停等待或繼續。

---

### P4 – 歷史記錄與回顧（Priority: P2）

**描述**  
使用者希望確認自己是否有進步，並回顧過去的練唱結果：

1. 在「歷史記錄」頁面可看到自己最近至少 20 筆練唱紀錄（包含單人與對唱）。
2. 每筆紀錄包含：日期時間、歌曲名稱、總分、簡短評語與是否有分享/對唱標記。
3. 點選某筆紀錄可以進入詳細頁：
    - 回放該次練唱的曲線（標準 / 實際）。
    - 查看分段分數與當時的建議。
    - 若有分享或對唱，顯示當時的分享狀態／對唱夥伴暱稱（視隱私設定）。

---

## 3. 功能需求（Functional Requirements）

> 編號僅為管理方便，實作時可依實際情況拆分。

### 單人練唱（P1）

-   **FR-001**：系統需提供上傳音檔與輸入歌曲基本資訊的流程，支援常見格式（如 MP3 / WAV），檔案大小限制與錯誤需有明確提示。
-   **FR-002**：需有簡單的麥克風測試與音量偵測機制；若偵測到背景噪音過高，須提示使用者調整。
-   **FR-003**：在練唱過程中，即時顯示：
    -   標準曲線（預先定義或預處理得到的目標音高）
    -   即時曲線（使用者實際音高）  
        並以顏色或標記提示偏高／偏低／跟不上節奏。
-   **FR-004**：練唱結束後，必須產生：
    -   總分（0–100 分）
    -   重要段落的分數或評價
    -   1–3 則可讀的建議文字（偏鼓勵而非打擊）

### 分享與共賞（P2）

-   **FR-010**：在結果頁提供「建立分享連結」功能，生成可分享的 URL 或邀請碼。
-   **FR-011**：任何人持有連結即可透過瀏覽器開啟分享頁面；未登入使用者僅具有閱讀與基本互動權限。
-   **FR-012**：分享頁面必須呈現：
    -   這次練唱的標準／實際曲線（可簡化但不得失真）
    -   總分與主要段落分數
    -   簡短建議摘要
-   **FR-013**：若啟用「即時共賞」，觀眾在主唱練唱時看到的曲線更新延遲應控制在可接受範圍（目標 < 1 秒，視技術可行性調整），前提是同時線上觀眾數量在產品設定的人數上限（例如 5–10 人）以內。
-   **FR-014**：主唱可隨時結束分享或收回連結，之後再訪問該連結須顯示「已結束分享」的狀態。

### 雙人對唱（P3）

-   **FR-020**：系統需提供建立「對唱房」的功能，包含房間代碼、歌曲與段落設定。
-   **FR-021**：對唱房限制同時最多 2 名主唱與 2 名觀眾，超出時需阻擋加入並顯示原因；觀眾僅能觀看與留下互動訊息（若有設計），不得影響對唱流程。
-   **FR-022**：對唱開始後，需顯示：
    -   雙方各自的實際曲線
    -   雙方與標準曲線的偏差
    -   雙方之間的同步與合唱一致性（例如：和聲精準度、進出點差距）
-   **FR-023**：對唱結束後，需生成：
    -   個別成績報告（類似單人）
    -   合唱報告（以合唱為單位的分數與評語）  
        並可選擇是否寫入歷史記錄。
-   **FR-024**：任一方在對唱過程中中斷連線時，應允許在 10 秒內重連；若重連失敗，系統需允許另一方選擇結束或重新開始。

### 歷史記錄與回顧（P4）

-   **FR-030**：提供「歷史記錄」頁面，預設顯示最新的數十筆練唱紀錄，支援依日期篩選。
-   **FR-031**：詳細紀錄頁面必須可以回放當次曲線，顯示當時的分數與建議。
-   **FR-032**：若該紀錄曾被分享或對唱，詳細頁需顯示分享／對唱相關資訊（不包含敏感個資），並遵守隱私設定。

---

## 4. 重要實體與資料模型（高層次）

-   **PracticeSession**
    -   單次練唱的主資料：歌曲資訊、時間、設定、結果摘要。
-   **PitchContour**
    -   儲存標準與實際音高隨時間的序列（可壓縮或抽樣）。
-   **ScoreReport**
    -   儲存各種分數（總分、段落分、節奏、穩定度等）與建議文字。
-   **PracticeHistoryEntry**
    -   歷史記錄列表使用的精簡版本（指向 `PracticeSession`）。
-   **ShareLink**
    -   分享連結 ID、對應的 `PracticeSession`、發起者、到期時間、是否即時共賞。
-   **DuetRoom**
    -   一次對唱房的資訊：房間代碼、歌曲設定、兩位主唱、狀態、結果。
-   **AudiencePresence**
    -   觀眾連線狀態，協助限制人數與計算線上觀眾數。

---

## 5. 成功指標（Success Criteria）

綜合原本 spec 與分享／對唱需求：

-   **SC-001**：90% 以上第一次使用者可在 60 秒內完成首次上傳並看到結果。
-   **SC-002**：單人練唱時，即時曲線更新延遲在 0.3 秒以內（視瀏覽器效能實測調整）。
-   **SC-003**：分享連結加入成功率 ≥ 95%，前 50 位觀眾平均 2 秒內看到最新曲線或結果。
-   **SC-004**：對唱房成功建立並完成的比率 ≥ 85%，雙方在中斷後 10 秒內可重新加入原房間的比例 ≥ 90%。
-   **SC-005**：至少 70% 的使用者在第一週內會重複使用 SoloKey（查看歷史或進行新練唱），顯示歷史記錄與分享／對唱功能具重複使用價值。

> 註：上述成功指標預計在 v1 上線後的前 4–8 週內，以內部測試者與邀請制早期使用者的實際使用行為作為評估基準。

---

## 6. 假設與依賴

-   使用者自行決定分享對象，SoloKey 僅提供連結與人數限制，不負責實名驗證。
-   分享與對唱為小房模式，最多 2 名主唱與少量觀眾，不追求大規模公眾直播。
-   歷史記錄只保留必要的練唱資訊，觀眾無法編輯或刪除他人紀錄。
-   系統需在主流桌機瀏覽器（Chrome / Edge）運作良好，行動裝置支援可延後考慮。
