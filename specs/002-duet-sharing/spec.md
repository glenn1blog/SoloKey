# 功能規格：SoloKey 分享與對唱模式

**功能分支**：`002-duet-sharing`  
**建立日期**：2025-11-27  
**狀態**：Draft  
**輸入來源**：使用者描述「我想調整一下 不需要有老師學生這種使用情境，所以不需要主要情境二 然後是可以多個分享給他人看 或是一起練習對唱 但有限人數這樣」

> 目標：SoloKey 以個人練唱為主，並新增「限量分享觀看」與「多人同場對唱」兩種互動場景，取代原本的老師/學生情境。以下僅描述「要做到什麼、為什麼」，不涉及技術實作細節。

## 產品定位與角色

- **定位**：SoloKey 為個人音準教練，同時支援彈性分享與對唱練習，讓使用者能在家中與朋友協作或互相觀摩。
- **主要角色**：
  1. **單人練唱者**：核心體驗，需完成一次完整上傳、練唱與回饋。
  2. **分享觀眾 / 合作夥伴**：透過邀請連結加入，可同時容納不限人數的觀眾瀏覽或留言。
  3. **對唱夥伴**：同時在同一段落練習並比較雙方音準（同步限制以小房模式保障體驗）。

## 使用者情境與測試（必填）

### 使用者故事 1－單人練唱完成一次練習（Priority: P1）

- **描述**：單人使用者可上傳音檔、即時查看雙曲線、完成練唱並獲得分數與建議。
- **優先原因**：為所有分享/對唱功能奠定基礎，若無穩定單人流程，其他情境無從談起。
- **獨立測試**：自動化腳本從首頁上傳 → 練唱 → 結果頁，全程驗證曲線、分數與文字建議同步變化。

**驗收情境**：

1. **Given** 使用者已準備合法音檔，**When** 透過首頁上傳並完成練唱，**Then** 系統顯示標準/即時曲線與分數報告。
2. **Given** 使用者在練唱中暫停並重啟，**When** 重新播放音檔，**Then** 曲線重新對齊且最終結果只包含最新一次。

---

### 使用者故事 2－分享與共賞（Priority: P2）

- **描述**：發起者可將練唱結果（或直播練唱）分享給不限人數的觀眾，觀眾可透過邀請連結即時觀看曲線、分數與留言。
- **優先原因**：使用者希望獲得同儕回饋或與親友共賞成果；移除老師角色後，共享機制成為主要互動手段，必須支援無人數障礙的公開共賞。
- **獨立測試**：模擬建立分享連結 → 多位受邀者加入 → 受邀者可看到同步資訊且延遲穩定；同時驗證發起者可隨時結束分享。

**驗收情境**：

1. **Given** 發起者完成練唱，**When** 產生邀請連結並分享給多位好友，**Then** 所有好友可即時看到最新曲線與分數，並可留言或按反應（僅基本互動）。
2. **Given** 分享已開啟，**When** 發起者點擊「結束分享」，**Then** 所有觀眾立即收到結束提示並無法再查看即時資料。

---

### 使用者故事 3－雙人對唱練習（Priority: P3）

- **描述**：兩位使用者在同一段落進行對唱，各自錄製聲部並即時看到雙方的曲線、偏差與合唱狀態。
- **優先原因**：對唱是多人練習的核心賣點，可建立社交黏性並延伸 SoloKey 的應用情境。
- **獨立測試**：模擬兩位瀏覽者加入同一對唱房，進行同步錄製，驗證結果頁顯示兩條個人曲線與合唱評語。

**驗收情境**：

1. **Given** 兩人同時加入對唱房，**When** 開始錄製，**Then** 系統同時回饋各自音準並顯示「雙方差距」視覺。
2. **Given** 任一方網路暫斷，**When** 重新連線，**Then** 系統允許在 10 秒內回到原位置並提示另一方暫停或繼續。

---

### 邊界情境 / Edge Cases

- 分享模式下若未達基本練唱完成條件（例如少於 30 秒），不允許生成邀請連結。
- 對唱房同時只允許 2 名主唱；額外觀眾最多 2 名，需採只讀模式。
- 發起者中途離線時，分享/對唱房需自動解散或交接主持權並通知所有人保存當前資料。
- 當分享觀眾過多導致延遲 > 1 秒時，需警示並建議切換為僅結果模式或限制留言頻率。

## 需求（必填）

### 功能需求

- **FR-001**：提供單人練唱引導（上傳、設定、練唱、結果），並以圖文列出偏差段落與建議。
- **FR-002**：完成練唱後可生成分享連結，允許不限人數的觀眾線上觀看，並提供隨時關閉或重設機制。
- **FR-003**：受邀者加入分享後可看到即時曲線、總分、段落分數與留言/表情功能，僅具觀看權限（不干擾發起者流程）。
- **FR-004**：雙人對唱房需提供房間代碼、等待室、雙方聲部錄製、同步曲線與「合唱一致性」數據。
- **FR-005**：對唱房達上限（2 名主唱 + 2 名觀眾）時須阻擋新的加入並顯示原因。
- **FR-006**：對唱完成後需生成個別與合唱報告，並可選擇是否存入歷史記錄。
- **FR-007**：分享與對唱流程需尊重新使用者的隱私設定（顯示或隱藏暱稱、允許留言與否）。
- **FR-008**：所有流程需在 3 個步驟內提供「離開 / 結束 / 解散」選項，確保使用者隨時掌控分享狀態。

### 重要實體（如涉及資料）

- **PracticeSession**：原本單人練習資料（含曲線、分數、備註），分享與對唱皆依此建立。
- **ShareLink**：紀錄分享連結 ID、發起者、可加入人數、到期時間、留言紀錄。
- **DuetRoom**：代表一次對唱房，包含房間代碼、兩位主唱資訊、同步狀態與合唱評語。
- **AudiencePresence**：追蹤受邀者/觀眾連線狀態，判斷是否超出上限。

## 成功指標（必填）

- **SC-001**：90% 以上單人使用者可在 60 秒內完成首次上傳並看到結果。
- **SC-002**：分享連結加入成功率 ≥ 95%，前 50 位觀眾平均 2 秒內看到最新曲線。
- **SC-003**：對唱房成功建立並同步完成的比率 ≥ 85%，雙方重新連線時間 ≤ 10 秒。
- **SC-004**：分享觀眾人數超過 50 人時，90% 的觀眾仍能保持畫面更新延遲 < 1 秒。
- **SC-005**：70% 分享或對唱的使用者選擇將結果儲存於歷史記錄，顯示功能具重複使用價值。

## 假設與依賴

- 使用者自行決定分享對象，SoloKey 僅提供邀請碼與連線限制，不負責身份驗證。
- 分享/對唱僅支援小型房間（最多 4 人）以確保延遲可接受，未開放公眾直播。
- 歷史記錄保留單人與對唱結果，受邀者僅能暫時查看，不具備編輯或刪除權。
